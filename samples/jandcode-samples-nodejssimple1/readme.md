jandcode-samples-nodejssimple1
==============================
                   
Пример простейшего приложения с поддержкой nodejs.

Проект создан на основе стандартного web-app командой:

```
jc create -t:web-app -o:jandcode-samples-nodejssimple1
```

Создаем модуль nodejs для клиентского кода в каталоге `frontend`:

```
mkdir frontend
cd frontend
npm init -y
```

Вносим изменения в `project.jc` для поддержки nodejs, как в примере.

Выполняем команду:
           
```
jc gen-idea
```

Предварительная заготовка проекта готова.
                         

npm/nodejs/node_modules
-----------------------

Для проекта формируется определенная среда, в которой настраивается местоположение
всех доступных модулей. Эта среда доступна при выполнении команд OS через `jc @ COMMAND`.
Т.е. выполнение команд OS должно сопровождатся префиксом `jc @`. Например для сборки
webpack необходимо выполнить команду:

```
jc @ webpack
```
       
Среда формируется командой:

```
jc prepare
```

Эту команду нужно вызывать после каждого изменения файлов, которые влияют на среду.
Это файлы `project.jc` и `package.json`. 

Команда `jc` перед выполнением выполняет файлы `jc-env.bat`, `_jc-env.bat` и `_jc/env-bat`.
В этих файлах, при их наличии, инициализируются переменные среды, которые позволяют
выполнять команды в определенной среде.

В примере имеется файл `fronend/example-script.js`. В нем используется внешний модуль 
`axios`. Для его правильного выполнения нужно выполнить команду:

```
jc @ node example-script.js
```

Для всех модулей, которые задействованы в проекте, формируется один каталог `node_modules`,
который располагается в каталоге `_jc/nodejs-nm-holder`. 

В каталоге `_jc/nodejs-nm-holder` генерируется файл `package.json`, в который включаются
все зависимости из всех модулей `nodejs`, задействованных в проекте. 

Подразумевается, что приложение разрабатывается как единое целое, и зависимости в модулях
являются совместимыми. При конфликте версий зависимостей, будет включена зависимость
из последнего подключенного модуля, так что за зависимостями нужно следить.

`webpack` требует указания мест, где находятся модули, которые будут использованы как
зависимости в исходниках и как модули для внутреннего использования (например loader-ы).
Для этого, при формировании среды, генерируется файл  
`_jc/nodejs-prepare/jc-nodejs-modules.js`. Этот файл автоматически выполняется
при выполнении любой команды `nodejs` (см. `_jc/jc-env.bat`). 
Однако, что бы webpack смог восмользоватся этой информацией при сборке,
ее нужно ему явно указать. Пример этого показан в файле `fronend/webpack.config.js`.


frontend
--------

`frontend` - это обычный модуль nodejs, тут можно использовать все, что Вам будет
необходимо для разработки клиентского приложения. 

Имеются определенные соглашения и требования к этому модулю:

* в `package.json` необходимо описать скрипт с именем "build", который должен собрать
  проект
* при сборке проекта учитывать значение переменной среды `NODE_ENV`, и при 
  значении `production` - собирать продуктовую сборку.  
* сборка должна осуществляться в каталог `_gen`, который находится в корне модуля `frontend`.
  Можно собирать в любой подкаталог каталога `_gen`, просто стоит иметь ввиду,
  что корень каталога `_gen` будет примонтирован к корню виртуальной файловой системы
  в Вашем web-приложении
* Дополнительно можно (не обязательно, но желательно) создать скрипт "watch". 
  Он должен собирать проект и отслеживать изменения в исходниках. 
  При изменении - пересобирать проект.

Обчная практика:

* для сборки используется webpack
* точка входа доступна как переменная `MainApp`
* экспортируемая функция `run` запускает приложение
* экспортировать моно и другие функции для различных целей

backend
-------

Файлы, которые сгенерированы в каталог `frontend/_gen`, будут доступны как 
файлы в корне web-приложения. Например здесь файлы генерируются в каталог
`frontend/_gen/public`. Если приложение запущено по адресу
`http://localhost:8080/jc`, то файл `main.bundle.js` будет доступен как
`http://localhost:8080/jc/public/main.bundle.js`.

Подключение осуществляется при выполнении команд `jc prepare` или `jc gen-idea` 
(которая вызывает `jc prepare` перед своим выполнением). Подключение каталога 
`frontend/_gen` генерируется в файле `_app.cfx`, можете посмотреть как.

При сборке продукта, это файлы будут обраны в `web-resource-webroot.jar`,
который будет включен в продукт. Можете выполнить сборку продукта
`jc product` и посмотреть результат.

Создаем `main.gsp` в корне модуля `jandcode/samples/nodejssimple1/main`
(см. в примере). В тексте подключаем `public/main.bundle.js` и вызываем
`MainApp.run()`. Созданный `main.gsp` подключаем как шаблон action `root`
(см. `module.cfx`). Теперь при открытии адреса `http://localhost:8080/jc`
будет запущено Ваше приложение.
         

Сборка
------

Для сборки проекта nodejs предоставляется команда:

```
jc nodejs-build
```

Эта команда подготовливает среду (`jc prepare`) и запускает сборку в главном модуле
`frontend` (`jc @ npm build`). Так же эта команда автоматически вызывается при полной
сборке проекта (`jc build`) и при подготовке дистрибутива (`jc product`).

