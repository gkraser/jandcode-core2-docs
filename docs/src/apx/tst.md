
tst
====

@@code-info 
    module=jandcode.core.apx.tst

Поддержка тестирования в контексте клиентского web-приложения.

Введение
--------

При генерации проекта `apx-app` к нему по умолчанию подключается
модуль `jandcode.core.apx.tst`. Он будет загружатся только в 
dev-режиме.

При подключенном модуле становится доступен url
`http://localhost:8080/jc/_tst`.

Модуль содержит ряд инструментов для упрощения тестирования
и прототипирования в web-приложении. 

Папка _tst
----------

Если в корне исходников модуля имеется папка `_tst`, то ее содержимое рассматривается
как набор тестовых клиентских файлов. Папка по умолчанию создается при генерации проекта
и заполняется некоторым набором файлов. 

Эта папка и ее содержимое исключается при сборке модуля в jar.
Соотвественно в product она не попадает.

Выполнение файлов через /_tst/run
---------------------------------

Когда вы щелкаете по пункту меню `/_tst/run`, вы попадает в список файлов,
которые можно выполнить. Этот список формируется из каталогов `_tst` всех 
доступных модулей в исходниках.
В список попадают файлы:

* `**/*.test.js` 
* `**/*.test.vue`
* `**/*.html.gsp`

### **/*.test.js

Этот js-файл должен содержать экспортируемый метод `run()` или 
определения unit-тестов.

Если имеется метод `run()`, то этот метод просто выполняется.
Пример файла с методом `run()`:

@@code file=samples/apx-app-template/xxx-yyy-main/src/xxx/yyy/main/_tst/_prototype/run1.test.js
    title=run1.test.js
 
В качестве среды выполнения unittest используется [mocha](https://mochajs.org/) в режиме
`bdd`. Для assert используется библиотека [chai](https://www.chaijs.com/).
Достаточно объявить тесты в тексте js и они будут выполнятся при открытии такого файла.
Пример файла с unittest:

@@code file=samples/apx-app-template/xxx-yyy-main/src/xxx/yyy/main/_tst/tests/test1.test.js
    title=test1.test.js
 
### **/*.test.vue

Файл содержит vue-компонент, который рендерится.
Любой обычный vue-компонент, но можно использовать и расширенный вариант его,
например:

@@code file=samples/apx-app-template/xxx-yyy-main/src/xxx/yyy/main/_tst/_prototype/Vue1.test.vue
    lang=html title=Vue1.test.vue
    
Кроме того, vue-компонент можно рендерить в контексте вашего приложения,
что бы он мог пользоватся данными и функционалом приложения:

@@code file=samples/apx-app-template/xxx-yyy-main/src/xxx/yyy/main/_tst/_prototype/InAppVue1.test.vue
    lang=html title=InAppVue1.test.vue
    
### **/*.html.gsp

Обычная gsp, рендерится без окружения:

@@code file=samples/apx-app-template/xxx-yyy-main/src/xxx/yyy/main/_tst/_prototype/gsp1.html.gsp
    title=gsp1.html.gsp


Особые файлы в _tst
-------------------

Некоторые файлы в корне `_tst` имеют важное значение для поддержки тестовой среды.

### vendor.js

@@code file=samples/apx-app-template/xxx-yyy-main/src/xxx/yyy/main/_tst/vendor.js
    title=vendor.js
 
Этот файл содержит импорт и экспорт среды, в которой будет проводится
тестирования по умоланию. В своем коде вы можете импортировать из этого файла
то, что вам нужно. И менять его, дополняя необходимымы модулями.
   
### run-js.gsp

@@code file=samples/apx-app-template/xxx-yyy-main/src/xxx/yyy/main/_tst/run-js.gsp
    title=run-js.gsp
 
Этот файл содержит gsp, которая рендерит страницу для запуска файлов js и vue.
При необходимости - его можно заменить на свой вариант.

### env-tst.js

@@code file=samples/apx-app-template/xxx-yyy-main/src/xxx/yyy/main/_tst/env-tst.js
    title=env-tst.js
 
Этот файл испортируется в `run-js.gsp` перед вашим кодом.
Используется для разделения импорта среды и кода тестов. Или для воссоздания 
особой среды.


run-js.gsp в подкаталоге
------------------------

Если создать подкаталог в `_tst` и поместить в него файл `run-js.gsp`,
то именно этот файл будет использоватся для рендеринга запускаемых файлов.
Кроме этого, если в этот же каталог поместить `env-tst.js`, то этот
файл будет использоватся для инициализации среды.
Это можно использовать для определения особой среды для особых частей 
тестов.

