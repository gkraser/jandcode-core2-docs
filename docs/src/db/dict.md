Словари
=======

@@code-info class=jandcode.core.dbm.dict.Dict class=jandcode.core.dbm.dict.DictService

Введение
--------

Словарь - это объект `jandcode.core.dbm.dict.Dict`, который содержит соответствие между
неким кодом (id) и его текстовым представлением.

Работа со словарями осуществляется через сервис модели
`jandcode.core.dbm.dict.DictService`.

Данные словаря представляют собой табличную структуру типа `jandcode.core.store.Store`.
Поле `id` - это идентификатор записи (код). Остальные поля - текстовые представления
идентификатора записи.

Сам объект `jandcode.core.dbm.dict.Dict` данные не хранит, он содержит информацию о
структуре словаря и способах загрузки данных.

Описание словаря
----------------

Словарь описывается в модели. Пример:

@@code file=define-dict1.xml


Работа со словарями
-------------------

Пример:

@@code file=DictExample1.groovy part=example1


Загрузка данных для словаря
---------------------------

Данные для словаря загружаются через его обработчик, которые реализует интерфейс
`jandcode.core.dbm.dict.DictHandler`.

При реализации обработчика необходимо для словаря dict загрузить в data строки, которые
соответсвуют набору id, переданному в параметре ids. Для загрузки можно использовать
объект mdb, соединение с базой данных установлено.

Простейший пример:

@@code file=MyDict1Handler.groovy

Полностью загружаемые словари
-----------------------------

Существуют словари, данные для которых можно загружать сразу полностью. Это обычно часто
используемые и небольшие словари. Для реализации полной загрузки обработчик должен
дополнительно реализовывать интерфейс
`jandcode.core.dbm.dict.IDictHandlerLoadDict`.

В случае полностью загружаемого словаря метод `Dict@isLoadable()` возвращает `true`.

Простейший пример:

@@code file=MyDict1LoadDictHandler.groovy


Базовые классы обработчиков для словаря
---------------------------------------

Для упрощения разработки имеются 2 базовых класса обработчиков словарей:

* `jandcode.core.dbm.dict.BaseDictHandlerResolve` - для обычных словарей, которые не могут
  быть полностью загруженными
* `jandcode.core.dbm.dict.BaseDictHandlerLoadable` - для словарей, которые могут быть
  полностью загруженными
  
Примеры:

@@code file=BaseDictHandlerResolveExample1.groovy
       title=jandcode.core.dbm.dict.BaseDictHandlerResolve
                                                 
@@code file=BaseDictHandlerLoadableExample1.groovy
       title=jandcode.core.dbm.dict.BaseDictHandlerLoadable
                      

Кеширование полностью загружаемых словарей
------------------------------------------

Данные полностью загружаемых словарей можно кешировать. Для этого нужно получать
данные словаря через `DictService#getCache()`.

@@code file=DictExample1.groovy part=cache1
                                 
!!! note
    Из кеша возвращаются оригинальные общие данные и разделяются между потоками, 
    поэтому их нельзя модифицировать!

Конфигурация module.cfx
-----------------------

### dbm/model/dict

Описание словаря.

Формат:

@@code file=cfx-dbm-model-dict.xml

* `name` - имя словаря
* `parent` - имя предка словаря
* `domain` - имя домена со структурой словаря. По умолчанию - `dict.base`
* `defaultField` - имя поля по умолчанию для получения текстового представления. По
  умолчанию - `text`
* `handler` - обработчик словаря для загрузки данных. Должен реализовывать интерфейс
  `jandcode.core.dbm.dict.DictHandler`. Дополнительно может реализовывать интерфейс
  `jandcode.core.dbm.dict.IDictHandlerLoadDict`
  
  






