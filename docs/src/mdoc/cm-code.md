
code - вставка фрагментов кода
====

Описание
--------

Вставка фрагментов кода из файлов проекта (например java, js и т.п).

Формат:

```
@@code file=FILENAME part=PARTNAME lang=LANG title=ЗАГОЛОВОК
```

где:

* `file` - имя файла из проекта, откуда вставлять текст.
  Может быть абсолютным и относительным (см: [](ref.md)).
  Если содержит `'#'`, то считается что указывает на файл с groovy-классом 
  (или java-классом) для генерации текста файла (см: [](#gen)).
* `part` - имя поименнованного фрагмента из файла (см. ниже). Если не указан, вставляется
  весь текст файла
* `lang` - имя языка для подсветки синтаксиса. Если не указано, определяется по расширению
  файла
* `title` - заголовок. Обычно тут указывается имя файла.
* `mode` - режим вывода при генерации (см: [](#gen)).

Особые соглашения по имени файла:

* если файл не абсолютный (не имеет `/` в начале), то он последовательно ищется 
в каталогах:
    * `_inc/ИМЯ-ФАЙЛА-СТАТЬИ` 
    * `_inc/ИМЯ_ФАЙЛА_СТАТЬИ` 
    * `_inc`
    * относительно текущего каталога    
     
Например, мы имеем статью `folder1/my-doc1.md` и в ней описана вставка кода:

```
@@code file=file1.java 
```

Тогда будут искаться следующие файлы:

* `folder1/_inc/my-doc1/file.java`
* `folder1/_inc/my_doc1/file.java`
* `folder1/_inc/file.java`
* `folder1/file.java`
 
Первый найденный будет использован.
     
     

Поименнованные фрагменты файла
------------------------------

В некоторых типах файлов можно определять поименнованные фрагменты, которые позволяют
вставлять не весь текст файла, а только его часть.

### java/groovy/js

Начало фрагмента определяется коментарием `//= PART-NAME`, конец фрагмента - `//=`.
Начало фрагмента является концом предыдущего, поэтому если фрагменты идут один
за другим, конец фрагмента можно не указывать.

Пример:

```groovy
def s = "hello"
//= part1
def n1 = 1
//= part2
def n2 = 2
//=
def n0 = 0
//= part3
def n3 = 3
//=
```

В этом примере определены 3 фрагмента со следующим содержимым:

```
Фрагмент part1:
  def n1 = 1

Фрагмент part2:
  def n2 = 2

Фрагмент part3:
  def n3 = 3
```

В качестве имени фрагмента можно указать имя метода. В этом случае в качестве фрагмента
будет использоватся тело метода. Если тело метода содержит фрагмент `body`, то этот
фрагмент будет использоватся в качестве тела метода. Фрагмент с именем `имяМетода-all`
содержит полное тело метода, без учета фрагмента `body`.

Пример:

```groovy
class A1 {
    void m1() {
        def n1 = 1        
    }
    void m2() {
        def n2 = 2
        //= body        
        def n3 = 3
        //=         
        def n4 = 4
    }
}
```

В этом примере определены фрагменты:

```
Фрагмент m1:
  def n1 = 1

Фрагмент m2:
  def n3 = 3

Фрагмент m2-all:
  def n2 = 2
  def n3 = 3
  def n4 = 4
```

### xml/html

Начало фрагмента определяется коментарием `<!-- = PART-NAME -->`,
конец фрагмента - `<!-- = -->`.
Начало фрагмента является концом предыдущего, поэтому если фрагменты идут один
за другим, конец фрагмента можно не указывать.


Генерация файлов для вставки {#gen}
----------------------------

Для генерации файлов для вставки, создайте файл groovy (или java) в проекте с классом, 
наследником от `jandcode.mdoc.cm.BaseCodeGen`. 

Любой публичный метод без параметров в таком классе - код генерации текста.

Для использования генератора укажите в атрибуте `file` имя файла с генератором
и после знака `'#'` имя его метода. 

Если расширение файла не указано, подразумевается расширение `.groovy` или `.java`. 

Дополнительно доступен атрибут `mode` со значениями:

* `out` - (по умолчанию) показывается то, что выводит `outText`. 
* `body` - тело метода
* `bodyout` - тело метода в перемешку с выводом

Пример:

@@code file=CodeGen1.groovy title=_inc/CodeGen1.groovy

Использование:

```
@@code file=CodeGen1#gen1 attr1=1 attr2=2
```

Результат:

@@code file=CodeGen1#gen1 attr1=1 attr2=2
 

Использование `mode=body`:

```
@@code file=CodeGen1#gen1 attr1=1 attr2=2 mode=body
```

Результат:

@@code file=CodeGen1#gen1 attr1=1 attr2=2 mode=body


Использование `mode=bodyout`:

```
@@code file=CodeGen1#gen1 attr1=1 attr2=2 mode=bodyout
```

Результат:

@@code file=CodeGen1#gen1 attr1=1 attr2=2 mode=bodyout





 





 

